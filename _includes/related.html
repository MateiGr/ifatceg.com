{% assign first_tag = page.tags | first %}

{% assign related_posts = site.posts | where_exp: "post", "post.tags.first == first_tag" | limit: 5 %}

{% if related_posts.size > 1 %}
<div class="related-posts">
  <h3>Other posts about {{ first_tag }}:</h3>
  <ul>
    {% for post in related_posts %}
      {% if post.url != page.url %}
        <li>{{ post.date | date: "%d %B %Y" }} - <a href="{{ post.url }}">{{ post.title }}</a></li>
      {% endif %}
    {% endfor %}
  </ul>
</div>
{% else %}
 <div class="related-posts">
    <h3>Other posts about the "{{ page.categories.first }}":</h3>
    <small>There are no other posts covering {{ first_tag }} at this time.</small>
    <ul>
      {% for post in site.categories[page.categories.first] limit:5 %}
        {% if post.url != page.url %}
          <li>{{ post.date | date: "%d %B %Y" }} - <a href="{{ post.url }}">{{ post.title }}</a></li>
        {% endif %}
      {% endfor %}
    </ul>
  </div>
{% endif %}
